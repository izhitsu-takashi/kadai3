<div class="dashboard-container">
  <header class="dashboard-header">
    <div class="header-content">
      <div class="app-name">{{ appName }}</div>
      <div class="header-actions">
        <button class="notification-button" type="button">お知らせ</button>
        <button 
          class="logout-button" 
          type="button"
          [disabled]="isLoggingOut"
          (click)="onLogout()">
          {{ isLoggingOut ? 'ログアウト中' : 'ログアウト' }}
        </button>
      </div>
    </div>
  </header>
  <div class="dashboard-body">
    <aside class="sidebar">
      <nav class="sidebar-menu">
        <ng-container *ngFor="let item of menuItems">
          <button 
            class="menu-item" 
            [class.active]="selectedMenuId === item.id || (item.id === 'settings' && (isSettingsExpanded || isSettingsSubMenuActive()))"
            type="button"
            [attr.data-id]="item.id"
            (click)="selectMenu(item.id)">
            {{ item.label }}
          </button>
          <!-- 設定のサブメニュー -->
          <div *ngIf="item.id === 'settings' && isSettingsExpanded" class="settings-submenu">
            <button 
              *ngFor="let subMenu of settingsSubMenus" 
              class="submenu-item" 
              [class.active]="isSettingsSubMenuSelected(subMenu.id)"
              type="button"
              (click)="selectSettingsSubMenu(subMenu.id)">
              {{ subMenu.label }}
            </button>
          </div>
        </ng-container>
      </nav>
    </aside>
    <main class="dashboard-content">
      <div *ngIf="selectedMenuId === 'insurance-list'" class="insurance-list-container">
        <div class="month-selector-container">
          <label for="month-select" class="month-select-label">表示月:</label>
          <select 
            id="month-select" 
            class="month-select"
            [value]="selectedMonth"
            (change)="onMonthChange($any($event.target).value)">
            <option *ngFor="let month of availableMonths" [value]="month">
              {{ month }}
            </option>
          </select>
        </div>
        <div class="table-container">
          <div *ngIf="isLoading" class="loading-message">
            <p>データを読み込み中...</p>
          </div>
          <ng-container *ngIf="!isLoading">
          <table *ngIf="employees && employees.length > 0" class="employee-table">
            <thead>
              <tr>
                <th *ngFor="let column of columns" 
                    [class.sortable-header]="column.sortable"
                    [class.non-sortable-header]="!column.sortable"
                    (click)="column.sortable && sortTable(column.key)">
                  <div class="table-header-content">
                    <span>{{ column.label }}</span>
                  </div>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let employee of sortedEmployees">
                <td>{{ getEmployeeId(employee) }}</td>
                <td>{{ getEmployeeName(employee) }}</td>
                <td>{{ getStandardSalary(employee) | number }}</td>
                <td>{{ getGrade(employee) }}</td>
                <td>{{ getHealthInsurance(employee) | number }}</td>
                <td>{{ getWelfarePension(employee) | number }}</td>
                <td>{{ getNursingInsurance(employee) | number }}</td>
                <td>{{ getPersonalBurden(employee) | number }}</td>
                <td>{{ getCompanyBurden(employee) | number }}</td>
              </tr>
            </tbody>
          </table>
          <!-- <div *ngIf="!employees || employees.length === 0" class="no-data-message">
            <p>データがありません</p>
          </div> -->
          </ng-container>
        </div>
      </div>
      <div *ngIf="selectedMenuId === 'company-settings' || selectedMenuId === 'health-insurance-settings' || selectedMenuId === 'insurance-rate-inquiry'" class="settings-page-container">
        <div class="page-message">
          <p>{{ getSettingsSubMenuLabel() }}のページです。</p>
        </div>
      </div>
      <div *ngIf="selectedMenuId === 'employee-settings'" class="settings-page-container">
        <app-import></app-import>
      </div>
      <div *ngIf="selectedMenuId === 'reports'" class="reports-container">
        <div class="report-filter-container">
          <div class="filter-type-selector">
            <label class="filter-type-label">表示単位:</label>
            <div class="radio-group">
              <label class="radio-label">
                <input 
                  type="radio" 
                  name="reportFilterType" 
                  value="month"
                  [checked]="reportFilterType === 'month'"
                  (change)="onReportFilterTypeChange('month')">
                <span>月単位</span>
              </label>
              <label class="radio-label">
                <input 
                  type="radio" 
                  name="reportFilterType" 
                  value="year"
                  [checked]="reportFilterType === 'year'"
                  (change)="onReportFilterTypeChange('year')">
                <span>年単位</span>
              </label>
            </div>
          </div>
          <div class="filter-selector">
            <label *ngIf="reportFilterType === 'month'" for="report-month-select" class="filter-label">表示月:</label>
            <label *ngIf="reportFilterType === 'year'" for="report-year-select" class="filter-label">表示年:</label>
            <select 
              *ngIf="reportFilterType === 'month'"
              id="report-month-select" 
              class="filter-select"
              [value]="reportSelectedMonth"
              (change)="onReportMonthChange($any($event.target).value)">
              <option *ngFor="let month of availableMonths" [value]="month">
                {{ month }}
              </option>
            </select>
            <select 
              *ngIf="reportFilterType === 'year'"
              id="report-year-select" 
              class="filter-select"
              [value]="reportSelectedYear"
              (change)="onReportYearChange($any($event.target).value)">
              <option *ngFor="let year of availableYears" [value]="year">
                {{ year }}年
              </option>
            </select>
          </div>
        </div>
        <div class="charts-container">
          <div class="chart-card">
            <h3 class="chart-title">社員負担額</h3>
            <div class="chart-wrapper">
              <canvas #personalBurdenChart></canvas>
            </div>
            <div class="chart-total">
              <p class="total-label">合計額</p>
              <p class="total-amount">{{ personalBurdenTotal.toLocaleString() }}円</p>
            </div>
          </div>
          <div class="chart-card">
            <h3 class="chart-title">会社負担額</h3>
            <div class="chart-wrapper">
              <canvas #companyBurdenChart></canvas>
            </div>
            <div class="chart-total">
              <p class="total-label">合計額</p>
              <p class="total-amount">{{ companyBurdenTotal.toLocaleString() }}円</p>
            </div>
          </div>
        </div>
      </div>
      <div *ngIf="selectedMenuId !== 'insurance-list' && selectedMenuId !== 'company-settings' && selectedMenuId !== 'health-insurance-settings' && selectedMenuId !== 'employee-settings' && selectedMenuId !== 'insurance-rate-inquiry' && selectedMenuId !== 'reports'" class="page-message">
        <p>{{ getSelectedMenuLabel() }}のページです。</p>
      </div>
    </main>
  </div>
</div>
