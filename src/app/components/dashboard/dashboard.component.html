<div class="dashboard-container" [class.tutorial-mode]="isTutorialMode">
  <header class="dashboard-header">
    <div class="header-content">
      <div class="app-name">{{ appName }}</div>
      <div class="header-actions">
        <button 
          class="notification-button" 
          type="button"
          (click)="toggleNotification()">
          お知らせ
          <span *ngIf="getUnreadNotificationCount() > 0" class="notification-badge">{{ getUnreadNotificationCount() }}</span>
        </button>
        <button 
          class="logout-button" 
          type="button"
          [disabled]="isLoggingOut || isHealthInsuranceSaving"
          (click)="onLogout()">
          {{ isLoggingOut ? 'ログアウト中' : 'ログアウト' }}
        </button>
      </div>
    </div>
  </header>
  <div class="dashboard-body">
    <aside class="sidebar">
      <nav class="sidebar-menu">
        <ng-container *ngFor="let item of menuItems">
          <button 
            class="menu-item" 
            [class.active]="selectedMenuId === item.id || (item.id === 'settings' && (isSettingsExpanded || isSettingsSubMenuActive()))"
            type="button"
            [attr.data-id]="item.id"
            (click)="selectMenu(item.id)">
            {{ item.label }}
          </button>
          <!-- 設定のサブメニュー -->
          <div *ngIf="item.id === 'settings' && isSettingsExpanded" class="settings-submenu">
            <button 
              *ngFor="let subMenu of settingsSubMenus" 
              class="submenu-item" 
              [class.active]="isSettingsSubMenuSelected(subMenu.id)"
              [class.setup-required]="isSubMenuSetupRequired(subMenu.id)"
              type="button"
              (click)="selectSettingsSubMenu(subMenu.id)">
              {{ subMenu.label }}
            </button>
          </div>
        </ng-container>
      </nav>
    </aside>
    <main class="dashboard-content">
      <div *ngIf="selectedMenuId === 'insurance-list'" class="insurance-list-container">
        <!-- 初期データ読み込み中のローディング表示 -->
        <div *ngIf="isInitialDataLoading" class="initial-loading-overlay">
          <div class="initial-loading-content">
            <div class="loading-spinner"></div>
            <p class="loading-message">データを読み込んでいます</p>
          </div>
        </div>
        <!-- 初期データ読み込み完了後のコンテンツ -->
        <div [class.loading-disabled]="isInitialDataLoading" class="insurance-list-content">
        <div class="filter-container">
          <div class="filter-row">
            <div class="filter-item">
              <label for="month-select" class="filter-label">表示月:</label>
              <select 
                id="month-select" 
                class="filter-select"
                [(ngModel)]="selectedMonth"
                [disabled]="isInitialDataLoading"
                (change)="onMonthChange($any($event.target).value)">
                <option *ngFor="let month of (tableType === 'salary' ? availableMonths : availableBonusMonths)" [value]="month">
                  {{ month }}
                </option>
              </select>
            </div>
            <div class="filter-item">
              <label for="health-insurance-filter" class="filter-label">健康保険:</label>
              <select 
                id="health-insurance-filter" 
                class="filter-select"
                [value]="filterHealthInsurance"
                [disabled]="isInitialDataLoading"
                (change)="filterHealthInsurance = $any($event.target).value; onFilterChange()">
                <option value="">すべて</option>
                <option value="健康保険被保険者">健康保険被保険者</option>
                <option value="健康保険被扶養者">健康保険被扶養者</option>
                <option value="任意継続被保険者">任意継続被保険者</option>
              </select>
            </div>
            <div class="filter-item">
              <label for="nursing-insurance-filter" class="filter-label">介護保険:</label>
              <select 
                id="nursing-insurance-filter" 
                class="filter-select"
                [value]="filterNursingInsurance"
                [disabled]="isInitialDataLoading"
                (change)="filterNursingInsurance = $any($event.target).value; onFilterChange()">
                <option value="">すべて</option>
                <option value="介護保険第1号被保険者">介護保険第1号被保険者</option>
                <option value="介護保険第2号被保険者">介護保険第2号被保険者</option>
                <option value="任意継続被保険者">任意継続被保険者</option>
                <option value="介護保険の被保険者でない者">介護保険の被保険者でない者</option>
                <option *ngIf="healthInsuranceType === 'kumiai'" value="特定被保険者（組合健保のみ）">特定被保険者（組合健保のみ）</option>
              </select>
            </div>
            <div class="filter-item">
              <label for="welfare-pension-filter" class="filter-label">厚生年金保険:</label>
              <select 
                id="welfare-pension-filter" 
                class="filter-select"
                [value]="filterWelfarePension"
                [disabled]="isInitialDataLoading"
                (change)="filterWelfarePension = $any($event.target).value; onFilterChange()">
                <option value="">すべて</option>
                <option value="国民年金第2号被保険者">国民年金第2号被保険者</option>
                <option value="国民年金第3号被保険者">国民年金第3号被保険者</option>
              </select>
            </div>
            <div class="filter-item">
              <label for="employment-status-filter" class="filter-label">在籍状況:</label>
              <select 
                id="employment-status-filter" 
                class="filter-select"
                [value]="filterEmploymentStatus"
                [disabled]="isInitialDataLoading"
                (change)="filterEmploymentStatus = $any($event.target).value; onFilterChange()">
                <option value="">すべて</option>
                <option value="在籍中">在籍中</option>
                <option value="退職済み">退職済み</option>
              </select>
            </div>
            <div class="filter-item">
              <div class="table-type-selector">
                <button 
                  type="button"
                  class="table-type-button"
                  [class.active]="tableType === 'salary'"
                  [disabled]="isInitialDataLoading"
                  (click)="onTableTypeChange('salary')">
                  給与
                </button>
                <button 
                  type="button"
                  class="table-type-button"
                  [class.active]="tableType === 'bonus'"
                  [disabled]="isInitialDataLoading"
                  (click)="onTableTypeChange('bonus')">
                  賞与
                </button>
              </div>
            </div>
            <div class="filter-item">
              <button 
                type="button"
                class="csv-export-button"
                [disabled]="isInitialDataLoading"
                (click)="exportToCSV()">
                CSV出力
              </button>
            </div>
          </div>
        </div>
        <div class="table-container">
          <div *ngIf="isLoading" class="loading-message">
            <p>データを読み込み中...</p>
          </div>
          <ng-container *ngIf="!isLoading">
          <!-- 事業者負担額表示（フィルター適用後のみ表示） -->
          <div *ngIf="isFilterApplied && ((tableType === 'salary' && sortedEmployees && sortedEmployees.length > 0) || (tableType === 'bonus' && sortedBonuses && sortedBonuses.length > 0))" class="employer-burden-display">
            <div class="employer-burden-label">{{ selectedMonth }}　事業者負担額合計</div>
            <div class="employer-burden-value">{{ getEmployerBurden() | number }}円</div>
          </div>
          <!-- 給与テーブル -->
          <table *ngIf="tableType === 'salary' && employees && employees.length > 0" class="employee-table">
            <thead>
              <tr>
                <th *ngFor="let column of columns" 
                    [class.sortable-header]="column.sortable"
                    [class.non-sortable-header]="!column.sortable"
                    (click)="column.sortable && sortTable(column.key)">
                  <div class="table-header-content">
                    <span>{{ column.label }}</span>
                  </div>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let employee of sortedEmployees" (click)="!isInitialDataLoading && openEmployeeModal(employee)" class="employee-row" [class.disabled]="isInitialDataLoading">
                <td>{{ getEmployeeId(employee) }}</td>
                <td>{{ getEmployeeName(employee) }}</td>
                <td>{{ getSalary(employee) | number }}</td>
                <td>{{ getStandardSalary(employee) | number }}</td>
                <td>{{ getHealthInsurance(employee, false) | number:'1.0-2' }}</td>
                <td>{{ getWelfarePension(employee, false) | number:'1.0-2' }}</td>
                <td>{{ getNursingInsurance(employee, false) | number:'1.0-2' }}</td>
                <td>{{ getPersonalBurden(employee, false) | number }}</td>
              </tr>
            </tbody>
          </table>
          <!-- 賞与テーブル -->
          <table *ngIf="tableType === 'bonus' && bonuses && bonuses.length > 0" class="employee-table">
            <thead>
              <tr>
                <th *ngFor="let column of columns" 
                    [class.sortable-header]="column.sortable"
                    [class.non-sortable-header]="!column.sortable"
                    (click)="column.sortable && sortTable(column.key)">
                  <div class="table-header-content">
                    <span>{{ column.label }}</span>
                  </div>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let bonus of sortedBonuses" (click)="!isInitialDataLoading && openEmployeeModal(bonus)" class="employee-row" [class.disabled]="isInitialDataLoading">
                <td>{{ getEmployeeId(bonus) }}</td>
                <td>{{ getEmployeeName(bonus) }}</td>
                <td>{{ getBonus(bonus) | number }}</td>
                <td>{{ getStandardBonus(bonus) | number }}</td>
                <td>{{ getHealthInsurance(bonus, true) | number:'1.0-2' }}</td>
                <td>{{ getWelfarePension(bonus, true) | number:'1.0-2' }}</td>
                <td>{{ getNursingInsurance(bonus, true) | number:'1.0-2' }}</td>
                <td>{{ getPersonalBurden(bonus, true) | number }}</td>
              </tr>
            </tbody>
          </table>
          <!-- <div *ngIf="!employees || employees.length === 0" class="no-data-message">
            <p>データがありません</p>
          </div> -->
          </ng-container>
        </div>
        </div>
      </div>
      <div *ngIf="selectedMenuId === 'company-settings'" class="settings-page-container">
        <div class="company-settings-form">
          <h2 class="form-title">企業情報設定</h2>
          <form (ngSubmit)="onCompanyInfoSubmit()" class="company-form">
            <div class="form-group">
              <label for="companyName" class="form-label">会社名（法人名）</label>
              <input 
                type="text" 
                id="companyName" 
                class="form-input"
                [(ngModel)]="companyInfo.companyName"
                name="companyName"
                [disabled]="!isCompanyInfoEditing"
                placeholder="会社名（法人名）を入力してください">
            </div>
            <div class="form-group">
              <label for="address" class="form-label">所在地（住所）</label>
              <input 
                type="text" 
                id="address" 
                class="form-input"
                [(ngModel)]="companyInfo.address"
                name="address"
                [disabled]="!isCompanyInfoEditing"
                placeholder="所在地（住所）を入力してください">
            </div>
            <div class="form-group">
              <label class="form-label">適用事業所種別</label>
              <div class="radio-group">
                <label class="radio-label">
                  <input 
                    type="radio" 
                    name="establishmentType" 
                    value="mandatory"
                    [(ngModel)]="companyInfo.establishmentType"
                    [disabled]="!isCompanyInfoEditing">
                  <span>強制</span>
                </label>
                <label class="radio-label">
                  <input 
                    type="radio" 
                    name="establishmentType" 
                    value="optional"
                    [(ngModel)]="companyInfo.establishmentType"
                    [disabled]="!isCompanyInfoEditing">
                  <span>任意</span>
                </label>
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">社会保険料徴収月</label>
              <div class="radio-group">
                <label class="radio-label">
                  <input 
                    type="radio" 
                    name="socialInsuranceCollectionMonth" 
                    value="current"
                    [(ngModel)]="companyInfo.socialInsuranceCollectionMonth"
                    [disabled]="!isCompanyInfoEditing">
                  <span>当月</span>
                </label>
                <label class="radio-label">
                  <input 
                    type="radio" 
                    name="socialInsuranceCollectionMonth" 
                    value="next"
                    [(ngModel)]="companyInfo.socialInsuranceCollectionMonth"
                    [disabled]="!isCompanyInfoEditing">
                  <span>翌月</span>
                </label>
              </div>
            </div>
            <div class="form-actions">
              <button 
                *ngIf="isCompanyInfoEditing" 
                type="submit" 
                class="submit-button">
                保存
              </button>
              <button 
                *ngIf="!isCompanyInfoEditing" 
                type="button" 
                class="edit-button"
                (click)="onEditCompanyInfo()">
                編集
              </button>
            </div>
          </form>
        </div>
      </div>
      <div *ngIf="selectedMenuId === 'health-insurance-settings'" class="settings-page-container">
        <div class="health-insurance-settings-form">
          <h2 class="form-title">健康保険設定</h2>
          <form (ngSubmit)="onHealthInsuranceSubmit()" class="health-insurance-form">
            <div class="form-group">
              <label class="form-label">健康保険種別</label>
              <div class="radio-group">
                <label class="radio-label">
                  <input 
                    type="radio" 
                    name="healthInsuranceType" 
                    value="kyokai"
                    [(ngModel)]="healthInsuranceType"
                    [disabled]="!isHealthInsuranceEditing || isHealthInsuranceSaving"
                    (change)="onHealthInsuranceTypeChange('kyokai')">
                  <span>協会けんぽ</span>
                </label>
                <label class="radio-label">
                  <input 
                    type="radio" 
                    name="healthInsuranceType" 
                    value="kumiai"
                    [(ngModel)]="healthInsuranceType"
                    [disabled]="!isHealthInsuranceEditing || isHealthInsuranceSaving"
                    (change)="onHealthInsuranceTypeChange('kumiai')">
                  <span>組合保険</span>
                </label>
              </div>
            </div>

            <!-- 協会けんぽの場合のフォーム -->
            <div *ngIf="healthInsuranceType === 'kyokai'" class="form-group">
              <label for="prefecture" class="form-label">都道府県</label>
                <select 
                id="prefecture" 
                class="form-select"
                [(ngModel)]="prefecture"
                name="prefecture"
                [disabled]="!isHealthInsuranceEditing || isHealthInsuranceSaving">
                <option value="">都道府県を選択してください</option>
                <option *ngFor="let pref of prefectures" [value]="pref">
                  {{ pref }}
                </option>
              </select>
            </div>

            <!-- 組合保険の場合のフォーム -->
            <div *ngIf="healthInsuranceType === 'kumiai'" class="form-group">
              <label for="insuranceRate" class="form-label">保険料率</label>
              <div class="insurance-rate-input-wrapper">
                <input 
                  type="text" 
                  id="insuranceRate" 
                  class="form-input"
                  [class.error]="insuranceRateError"
                  [value]="insuranceRateDisplay"
                  name="insuranceRate"
                  [disabled]="!isHealthInsuranceEditing || isHealthInsuranceSaving"
                  placeholder="保険料率を入力"
                  (input)="onInsuranceRateInput($event)"
                  (blur)="onInsuranceRateBlur()">
                <span class="percentage-symbol">%</span>
              </div>
              <div *ngIf="insuranceRateError" class="error-message">
                {{ insuranceRateError }}
              </div>
            </div>

            <!-- 従業員負担の保険料折半割合変更（組合健保専用） -->
            <div *ngIf="healthInsuranceType === 'kumiai'" class="form-group">
              <label for="employeeBurdenRatio" class="form-label">従業員負担の保険料折半割合</label>
              <div class="insurance-rate-input-wrapper">
                <input 
                  type="text" 
                  id="employeeBurdenRatio" 
                  class="form-input"
                  [class.error]="employeeBurdenRatioError"
                  [(ngModel)]="employeeBurdenRatioDisplay"
                  name="employeeBurdenRatio"
                  [disabled]="!isHealthInsuranceEditing || isHealthInsuranceSaving"
                  placeholder="割合を入力"
                  (blur)="onEmployeeBurdenRatioBlur()">
                <span class="percentage-symbol">%</span>
              </div>
              <div *ngIf="employeeBurdenRatioError" class="error-message">
                {{ employeeBurdenRatioError }}
              </div>
              <p class="form-help-text">※従業員負担割合を入力してください（例：40%と入力すると、従業員負担4割、事業主負担6割で計算されます）</p>
            </div>

            <!-- 組合保険の場合の等級設定 -->
            <div *ngIf="healthInsuranceType === 'kumiai'" class="form-group">
              <label class="form-label">等級</label>
              <div class="radio-group">
                <label class="radio-label">
                  <input 
                    type="radio" 
                    name="gradeSettingType" 
                    value="kyokai"
                    [(ngModel)]="gradeSettingType"
                    (ngModelChange)="onGradeSettingTypeChange()"
                    [disabled]="!isHealthInsuranceEditing || isHealthInsuranceSaving">
                  <span>協会けんぽに従う</span>
                </label>
                <label class="radio-label">
                  <input 
                    type="radio" 
                    name="gradeSettingType" 
                    value="custom"
                    [(ngModel)]="gradeSettingType"
                    (ngModelChange)="onGradeSettingTypeChange()"
                    [disabled]="!isHealthInsuranceEditing || isHealthInsuranceSaving">
                  <span>カスタム</span>
                </label>
              </div>
              
              <!-- カスタムの場合の等級上限選択 -->
              <div *ngIf="gradeSettingType === 'custom'" class="form-group" style="margin-top: 15px;">
                <label for="customMaxGrade" class="form-label">最大等級</label>
                <select 
                  id="customMaxGrade" 
                  class="form-select"
                  [(ngModel)]="customMaxGrade"
                  (ngModelChange)="onCustomMaxGradeChange()"
                  name="customMaxGrade"
                  [disabled]="!isHealthInsuranceEditing || isHealthInsuranceSaving">
                  <option *ngFor="let option of customGradeOptions" [value]="option.grade">
                    {{ option.grade }}等級（標準報酬月額上限{{ getMonthlyStandardByGrade(option.grade) }}万円）
                  </option>
                </select>

              </div>
            </div>

            <!-- 組合保険の場合の年間標準賞与額の上限変更 -->
            <div *ngIf="healthInsuranceType === 'kumiai'" class="form-group">
              <label class="form-label">健康保険課税対象の年間標準賞与額上限変更</label>
              <div class="radio-group">
                <label class="radio-label">
                  <input 
                    type="radio" 
                    name="annualBonusLimitType" 
                    value="kyokai"
                    [(ngModel)]="annualBonusLimitType"
                    (ngModelChange)="onAnnualBonusLimitTypeChange()"
                    [disabled]="!isHealthInsuranceEditing || isHealthInsuranceSaving">
                  <span>協会けんぽに従う</span>
                </label>
                <label class="radio-label">
                  <input 
                    type="radio" 
                    name="annualBonusLimitType" 
                    value="custom"
                    [(ngModel)]="annualBonusLimitType"
                    (ngModelChange)="onAnnualBonusLimitTypeChange()"
                    [disabled]="!isHealthInsuranceEditing || isHealthInsuranceSaving">
                  <span>カスタム</span>
                </label>
              </div>
              
              <!-- カスタムの場合の年間標準賞与額の上限入力 -->
              <div *ngIf="annualBonusLimitType === 'custom'" class="form-group" style="margin-top: 15px;">
                <label for="customAnnualBonusLimit" class="form-label">年間標準賞与額の上限</label>
                <div class="insurance-rate-input-wrapper">
                  <input 
                    type="text" 
                    id="customAnnualBonusLimit" 
                    class="form-input"
                    [(ngModel)]="customAnnualBonusLimit"
                    (ngModelChange)="onCustomAnnualBonusLimitChange()"
                    name="customAnnualBonusLimit"
                    [disabled]="!isHealthInsuranceEditing || isHealthInsuranceSaving"
                    placeholder="573">
                  <span class="percentage-symbol">万円</span>
                </div>
              </div>
            </div>

            <div class="form-actions">
              <button 
                *ngIf="isHealthInsuranceEditing" 
                type="submit" 
                class="submit-button"
                [disabled]="isHealthInsuranceSaving">
                {{ isHealthInsuranceSaving ? '保存中...' : '保存' }}
              </button>
              <button 
                *ngIf="!isHealthInsuranceEditing" 
                type="button" 
                class="edit-button"
                [disabled]="isHealthInsuranceSaving"
                (click)="onEditHealthInsurance()">
                編集
              </button>
            </div>
          </form>
        </div>
      </div>
      <div *ngIf="selectedMenuId === 'insurance-rate-inquiry'" class="settings-page-container">
        <div class="insurance-rate-inquiry-container">
          <h2 class="inquiry-title">保険料率照会</h2>
          <div class="rate-cards">
            <div class="rate-card">
              <div class="rate-card-header">
                <h3 class="rate-card-title">厚生年金保険料</h3>
              </div>
              <div class="rate-card-content">
                <p class="rate-value">18.3%</p>
              </div>
              <div class="rate-value-note">
                <p>※厚生年金保険料、介護保険料は令和7年度の料率です。</p>
              </div>
            </div>
            <div class="rate-card">
              <div class="rate-card-header">
                <h3 class="rate-card-title">介護保険料</h3>
              </div>
              <div class="rate-card-content">
                <p class="rate-value">1.59%</p>
              </div>
              <div class="rate-value-note">
                <p>※厚生年金保険料、介護保険料は令和7年度の料率です。</p>
                <p>※介護保険料は40歳以上の方が対象です。</p>
              </div>
            </div>
            <div class="rate-card">
              <div class="rate-card-header">
                <h3 class="rate-card-title">健康保険料</h3>
              </div>
              <div class="rate-card-content">
                <p *ngIf="healthInsuranceType === 'kumiai' && insuranceRate > 0" class="rate-value">{{ insuranceRate }}%</p>
                <p *ngIf="healthInsuranceType === 'kyokai' && prefecture && kenpoRates[prefecture]" class="rate-value">{{ kenpoRates[prefecture].healthRate }}%</p>
                <p *ngIf="healthInsuranceType === 'kyokai' && prefecture && !kenpoRates[prefecture]" class="rate-value-note">{{ prefecture }}</p>
                <p *ngIf="healthInsuranceType === 'kyokai' && !prefecture" class="rate-value-note">未設定</p>
                <p *ngIf="healthInsuranceType === 'kumiai' && insuranceRate === 0" class="rate-value-note">未設定</p>
              </div>
              <div class="rate-value-note">
                <p>※健康保険料は協会けんぽの場合、都道府県によって料率が異なります。</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div *ngIf="selectedMenuId === 'employee-settings'" class="settings-page-container">
        <app-import></app-import>
      </div>
      <div *ngIf="selectedMenuId === 'reports'" class="reports-container">
        <div class="report-filter-container">
          <div class="report-table-type-selector">
            <button 
              type="button"
              class="report-table-type-button"
              [class.active]="reportTableType === 'salary'"
              (click)="onReportTableTypeChange('salary')">
              給与
            </button>
            <button 
              type="button"
              class="report-table-type-button"
              [class.active]="reportTableType === 'bonus'"
              (click)="onReportTableTypeChange('bonus')">
              賞与
            </button>
          </div>
          <div class="filter-type-selector">
            <label class="filter-type-label">表示単位:</label>
            <div class="radio-group">
              <label class="radio-label">
                <input 
                  type="radio" 
                  name="reportFilterType" 
                  value="month"
                  [checked]="reportFilterType === 'month'"
                  (change)="onReportFilterTypeChange('month')">
                <span>月単位</span>
              </label>
              <label class="radio-label">
                <input 
                  type="radio" 
                  name="reportFilterType" 
                  value="year"
                  [checked]="reportFilterType === 'year'"
                  (change)="onReportFilterTypeChange('year')">
                <span>年度単位</span>
              </label>
            </div>
          </div>
          <div class="filter-selector">
            <label *ngIf="reportFilterType === 'month'" for="report-month-select" class="filter-label">表示月:</label>
            <label *ngIf="reportFilterType === 'year'" for="report-year-select" class="filter-label">表示年度:</label>
            <select 
              *ngIf="reportFilterType === 'month'"
              id="report-month-select" 
              class="filter-select"
              [(ngModel)]="reportSelectedMonth"
              (ngModelChange)="onReportMonthChange($event)">
              <option *ngFor="let month of (reportTableType === 'salary' ? availableMonths : availableBonusMonths)" [value]="month">
                {{ month }}
              </option>
            </select>
            <select 
              *ngIf="reportFilterType === 'year'"
              id="report-year-select" 
              class="filter-select"
              [(ngModel)]="reportSelectedYear"
              (ngModelChange)="onReportYearChange($event)">
              <option *ngFor="let year of (reportTableType === 'salary' ? availableYears : availableBonusYears)" [value]="year">
                {{ year }}年度
              </option>
            </select>
          </div>
          <button 
            type="button"
            class="pdf-create-button"
            (click)="createReportPDF()">
            PDF作成
          </button>
        </div>
        <div class="charts-container">
          <div class="chart-card">
            <h3 class="chart-title">社員負担額</h3>
            <div class="chart-wrapper">
              <canvas #personalBurdenChart></canvas>
            </div>
            <div class="chart-total">
              <p class="total-label">合計額</p>
              <p class="total-amount">{{ personalBurdenTotal.toLocaleString() }}円</p>
            </div>
          </div>
          <div class="chart-card">
            <h3 class="chart-title">会社負担額</h3>
            <div class="chart-wrapper">
              <canvas #companyBurdenChart></canvas>
            </div>
            <div class="chart-total">
              <p class="total-label">合計額</p>
              <p class="total-amount">{{ companyBurdenTotal.toLocaleString() }}円</p>
            </div>
          </div>
          <div class="chart-card">
            <h3 class="chart-title">合計保険料</h3>
            <div class="chart-wrapper">
              <canvas #totalBurdenChart></canvas>
            </div>
            <div class="chart-total">
              <p class="total-label">合計額</p>
              <p class="total-amount">{{ totalInsuranceTotal.toLocaleString() }}円</p>
            </div>
          </div>
        </div>
      </div>
      
      <div *ngIf="selectedMenuId !== 'insurance-list' && selectedMenuId !== 'company-settings' && selectedMenuId !== 'health-insurance-settings' && selectedMenuId !== 'employee-settings' && selectedMenuId !== 'insurance-rate-inquiry' && selectedMenuId !== 'reports'" class="page-message">
        <p>{{ getSelectedMenuLabel() }}のページです。</p>
      </div>
    </main>
  </div>
</div>

<!-- チュートリアルオーバーレイ -->
<div *ngIf="isTutorialMode" class="tutorial-overlay">
  <div class="tutorial-modal" (click)="$event.stopPropagation()">
    <div class="tutorial-header">
      <h2 class="tutorial-title">{{ getCurrentTutorialStep()?.title }}</h2>
      <button class="tutorial-close" (click)="endTutorial()" type="button">×</button>
    </div>
    <div class="tutorial-content">
      <p class="tutorial-description">{{ getCurrentTutorialStep()?.description }}</p>
      <div class="tutorial-progress">
        <span class="tutorial-step-info">
          {{ currentTutorialStep + 1 }} / {{ tutorialSteps.length }}
        </span>
      </div>
    </div>
    <div class="tutorial-footer">
      <button 
        class="tutorial-button tutorial-button-secondary" 
        (click)="previousTutorialStep()" 
        [disabled]="currentTutorialStep === 0"
        type="button">
        前へ
      </button>
      <button 
        class="tutorial-button tutorial-button-primary" 
        (click)="nextTutorialStep()" 
        type="button">
        {{ currentTutorialStep === tutorialSteps.length - 1 ? '終了' : '次へ' }}
      </button>
    </div>
  </div>
</div>

<!-- 社員情報モーダル -->
<div *ngIf="isModalOpen" class="modal-overlay" (click)="closeEmployeeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">社員情報</h2>
      <div class="modal-header-actions">
        <button class="modal-close-button" (click)="closeEmployeeModal()">×</button>
      </div>
    </div>
    <div class="modal-body" *ngIf="selectedEmployee">
      <div class="employee-info-container">
        <div class="info-row">
          <span class="info-label">ID</span>
          <span class="info-value">{{ getEmployeeField(selectedEmployee, 'ID') }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">氏名</span>
          <span class="info-value">{{ getEmployeeField(selectedEmployee, '氏名') }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">年齢</span>
          <span class="info-value">{{ getEmployeeField(selectedEmployee, '年齢') }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">性別</span>
          <span class="info-value">{{ getEmployeeField(selectedEmployee, '性別') }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">入社日</span>
          <span class="info-value">{{ formatDate(getEmployeeField(selectedEmployee, '入社日')) }}</span>
        </div>
        <div class="info-row" *ngIf="tableType === 'salary'">
          <span class="info-label">標準報酬月額</span>
          <span class="info-value">{{ getStandardSalary(selectedEmployee) | number }}円</span>
        </div>
        <div class="info-row" *ngIf="tableType === 'salary' && getStandardSalaryCalculationBase(selectedEmployee) > 0">
          <span class="info-label">標準報酬月額算出基準給与</span>
          <span class="info-value">{{ getStandardSalaryCalculationBase(selectedEmployee) | number }}円（{{ getStandardSalaryCalculationMethod(selectedEmployee) }}）</span>
        </div>
        <div class="info-row" *ngIf="tableType === 'bonus'">
          <span class="info-label">賞与</span>
          <span class="info-value">{{ getEmployeeField(selectedEmployee, '賞与') | number }}円</span>
        </div>
        <div class="info-row" *ngIf="tableType === 'bonus'">
          <span class="info-label">標準賞与額</span>
          <span class="info-value">{{ getStandardBonus(selectedEmployee) | number }}円</span>
        </div>
        <div class="info-row">
          <span class="info-label">健康保険料</span>
          <span class="info-value">{{ getHealthInsurance(selectedEmployee, tableType === 'bonus') | number:'1.0-2' }}円</span>
        </div>
        <div class="info-row">
          <span class="info-label">厚生年金保険料</span>
          <span class="info-value">{{ getWelfarePension(selectedEmployee, tableType === 'bonus') | number:'1.0-2' }}円</span>
        </div>
        <div class="info-row">
          <span class="info-label">介護保険料</span>
          <span class="info-value">{{ getNursingInsurance(selectedEmployee, tableType === 'bonus') | number:'1.0-2' }}円</span>
        </div>
        <div class="info-row">
          <span class="info-label">社員負担額</span>
          <span class="info-value">{{ getPersonalBurden(selectedEmployee, tableType === 'bonus') | number }}円</span>
        </div>
        <div class="info-row" *ngIf="tableType === 'bonus'">
          <span class="info-label">健康保険者種別</span>
          <span class="info-value">{{ getEmployeeField(selectedEmployee, '健康保険者種別') }}</span>
        </div>
        <div class="info-row" *ngIf="tableType === 'bonus' && healthInsuranceType === 'kyokai'">
          <span class="info-label">介護保険者種別</span>
          <span class="info-value">{{ getEmployeeField(selectedEmployee, '介護保険者種別') }}</span>
        </div>
        <div class="info-row" *ngIf="tableType === 'bonus' && healthInsuranceType === 'kumiai'">
          <span class="info-label">介護保険者種別（組合）</span>
          <span class="info-value">{{ getEmployeeField(selectedEmployee, '介護保険者種別（組合）') }}</span>
        </div>
        <div class="info-row" *ngIf="tableType === 'bonus'">
          <span class="info-label">厚生年金保険者種別</span>
          <span class="info-value">{{ getEmployeeField(selectedEmployee, '厚生年金保険者種別') }}</span>
        </div>
        <div class="info-row" *ngIf="tableType === 'bonus'">
          <span class="info-label">在籍状況</span>
          <span class="info-value">{{ getEmployeeField(selectedEmployee, '在籍状況') }}</span>
        </div>
        <div class="info-row" *ngIf="tableType === 'bonus'">
          <span class="info-label">年内賞与累計額</span>
          <span class="info-value">{{ getEmployeeField(selectedEmployee, '年内賞与累計額') | number }}円</span>
        </div>
        <div class="info-row" *ngIf="tableType === 'bonus'">
          <span class="info-label">年内賞与支給回数</span>
          <span class="info-value">{{ getEmployeeField(selectedEmployee, '年内賞与支給回数') }}</span>
        </div>
        <div class="info-row" *ngIf="tableType === 'salary'">
          <span class="info-label">健康介護保険等級</span>
          <span class="info-value">{{ getGrade(selectedEmployee) }}</span>
        </div>
        <div class="info-row" *ngIf="tableType === 'salary'">
          <span class="info-label">厚生年金保険等級</span>
          <span class="info-value">{{ getWelfarePensionGrade(selectedEmployee) > 0 ? getWelfarePensionGrade(selectedEmployee) : '-' }}</span>
        </div>
        <div class="info-row" *ngIf="tableType === 'salary'">
          <span class="info-label">健康保険者種別</span>
          <span class="info-value">{{ getEmployeeField(selectedEmployee, '健康保険者種別') }}</span>
        </div>
        <div class="info-row" *ngIf="tableType === 'salary' && healthInsuranceType === 'kyokai'">
          <span class="info-label">介護保険者種別</span>
          <span class="info-value">{{ getEmployeeField(selectedEmployee, '介護保険者種別') }}</span>
        </div>
        <div class="info-row" *ngIf="tableType === 'salary' && healthInsuranceType === 'kumiai'">
          <span class="info-label">介護保険者種別（組合）</span>
          <span class="info-value">{{ getEmployeeField(selectedEmployee, '介護保険者種別（組合）') }}</span>
        </div>
        <div class="info-row" *ngIf="tableType === 'salary'">
          <span class="info-label">厚生年金保険者種別</span>
          <span class="info-value">{{ getEmployeeField(selectedEmployee, '厚生年金保険者種別') }}</span>
        </div>
        <div class="info-row" *ngIf="tableType === 'salary' && getEmployeeField(selectedEmployee, '報酬加算額') !== '-' && getEmployeeField(selectedEmployee, '報酬加算額') !== 0">
          <span class="info-label">報酬加算額</span>
          <span class="info-value">{{ getEmployeeField(selectedEmployee, '報酬加算額') | number }}円</span>
        </div>
        <div class="info-row" *ngIf="tableType === 'salary'">
          <span class="info-label">在籍状況</span>
          <span class="info-value">{{ getEmployeeField(selectedEmployee, '在籍状況') }}</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- お知らせモーダル -->
<div *ngIf="isNotificationOpen" class="notification-overlay" (click)="closeNotification()">
  <div class="notification-modal" (click)="$event.stopPropagation()">
    <div class="notification-header">
      <h3 class="notification-title">お知らせ</h3>
      <button class="notification-close" (click)="closeNotification()">×</button>
    </div>
    <div class="notification-content">
      <div *ngIf="notifications.length === 0" class="notification-empty">
        <p>お知らせはありません</p>
      </div>
      <div 
        *ngFor="let notification of notifications; let i = index" 
        class="notification-item"
        [class.notification-read]="notification.read"
        (click)="markNotificationAsRead(i)">
        <div class="notification-icon">{{ getNotificationIcon(notification.type) }}</div>
        <div class="notification-text">
          <p class="notification-message">{{ notification.message }}</p>
          <p class="notification-date">{{ formatNotificationDate(notification.date) }}</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- 保存中オーバーレイ -->
<div *ngIf="isHealthInsuranceSaving" class="saving-overlay">
  <div class="saving-message">
    <p>保存中...</p>
  </div>
</div>
