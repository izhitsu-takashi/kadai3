<div class="dashboard-container" [class.tutorial-mode]="isTutorialMode">
  <header class="dashboard-header">
    <div class="header-content">
      <div class="app-name">{{ appName }}</div>
      <div class="header-actions">
        <button 
          class="notification-button" 
          type="button"
          (click)="toggleNotification()">
          お知らせ
          <span *ngIf="getUnreadNotificationCount() > 0" class="notification-badge">{{ getUnreadNotificationCount() }}</span>
        </button>
        <button 
          class="logout-button" 
          type="button"
          [disabled]="isLoggingOut"
          (click)="onLogout()">
          {{ isLoggingOut ? 'ログアウト中' : 'ログアウト' }}
        </button>
      </div>
    </div>
  </header>
  <div class="dashboard-body">
    <aside class="sidebar">
      <nav class="sidebar-menu">
        <ng-container *ngFor="let item of menuItems">
          <button 
            class="menu-item" 
            [class.active]="selectedMenuId === item.id || (item.id === 'settings' && (isSettingsExpanded || isSettingsSubMenuActive()))"
            type="button"
            [attr.data-id]="item.id"
            (click)="selectMenu(item.id)">
            {{ item.label }}
          </button>
          <!-- 設定のサブメニュー -->
          <div *ngIf="item.id === 'settings' && isSettingsExpanded" class="settings-submenu">
            <button 
              *ngFor="let subMenu of settingsSubMenus" 
              class="submenu-item" 
              [class.active]="isSettingsSubMenuSelected(subMenu.id)"
              [class.setup-required]="isSubMenuSetupRequired(subMenu.id)"
              type="button"
              (click)="selectSettingsSubMenu(subMenu.id)">
              {{ subMenu.label }}
            </button>
          </div>
        </ng-container>
      </nav>
    </aside>
    <main class="dashboard-content">
      <div *ngIf="selectedMenuId === 'insurance-list'" class="insurance-list-container">
        <div class="filter-container">
          <div class="filter-row">
            <div class="filter-item">
              <label for="month-select" class="filter-label">表示月:</label>
              <select 
                id="month-select" 
                class="filter-select"
                [value]="selectedMonth"
                (change)="onMonthChange($any($event.target).value)">
                <option *ngFor="let month of (tableType === 'salary' ? availableMonths : availableBonusMonths)" [value]="month">
                  {{ month }}
                </option>
              </select>
            </div>
            <div class="filter-item">
              <label for="department-filter" class="filter-label">部署:</label>
              <select 
                id="department-filter" 
                class="filter-select"
                [value]="filterDepartment"
                (change)="filterDepartment = $any($event.target).value; onFilterChange()">
                <option value="">すべて</option>
                <option *ngFor="let dept of availableDepartments" [value]="dept">
                  {{ dept }}
                </option>
              </select>
            </div>
            <div class="filter-item">
              <label for="employment-type-filter" class="filter-label">雇用形態:</label>
              <select 
                id="employment-type-filter" 
                class="filter-select"
                [value]="filterEmploymentType"
                (change)="filterEmploymentType = $any($event.target).value; onFilterChange()">
                <option value="">すべて</option>
                <option *ngFor="let type of availableEmploymentTypes" [value]="type">
                  {{ type }}
                </option>
              </select>
            </div>
            <div class="filter-item">
              <label for="nursing-insurance-filter" class="filter-label">介護保険:</label>
              <select 
                id="nursing-insurance-filter" 
                class="filter-select"
                [value]="filterNursingInsurance"
                (change)="filterNursingInsurance = $any($event.target).value; onFilterChange()">
                <option value="">すべて</option>
                <option value="with">有</option>
                <option value="without">無</option>
              </select>
            </div>
            <div class="filter-item">
              <div class="table-type-selector">
                <button 
                  type="button"
                  class="table-type-button"
                  [class.active]="tableType === 'salary'"
                  (click)="onTableTypeChange('salary')">
                  給与
                </button>
                <button 
                  type="button"
                  class="table-type-button"
                  [class.active]="tableType === 'bonus'"
                  (click)="onTableTypeChange('bonus')">
                  賞与
                </button>
              </div>
            </div>
            <div class="filter-item">
              <button 
                type="button"
                class="csv-export-button"
                (click)="exportToCSV()">
                CSV出力
              </button>
            </div>
          </div>
        </div>
        <div class="table-container">
          <div *ngIf="isLoading" class="loading-message">
            <p>データを読み込み中...</p>
          </div>
          <ng-container *ngIf="!isLoading">
          <!-- 給与テーブル -->
          <table *ngIf="tableType === 'salary' && employees && employees.length > 0" class="employee-table">
            <thead>
              <tr>
                <th *ngFor="let column of columns" 
                    [class.sortable-header]="column.sortable"
                    [class.non-sortable-header]="!column.sortable"
                    (click)="column.sortable && sortTable(column.key)">
                  <div class="table-header-content">
                    <span>{{ column.label }}</span>
                  </div>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let employee of sortedEmployees" (click)="openEmployeeModal(employee)" class="employee-row">
                <td>{{ getEmployeeId(employee) }}</td>
                <td>{{ getEmployeeName(employee) }}</td>
                <td>{{ getSalary(employee) | number }}</td>
                <td>{{ getStandardSalary(employee) | number }}</td>
                <td>{{ getGrade(employee) }}</td>
                <td>{{ getHealthInsurance(employee, false) | number }}</td>
                <td>{{ getWelfarePension(employee, false) | number }}</td>
                <td>{{ getNursingInsurance(employee, false) | number }}</td>
                <td>{{ getPersonalBurden(employee, false) | number }}</td>
                <td>{{ getCompanyBurden(employee, false) | number }}</td>
              </tr>
            </tbody>
          </table>
          <!-- 賞与テーブル -->
          <table *ngIf="tableType === 'bonus' && bonuses && bonuses.length > 0" class="employee-table">
            <thead>
              <tr>
                <th *ngFor="let column of columns" 
                    [class.sortable-header]="column.sortable"
                    [class.non-sortable-header]="!column.sortable"
                    (click)="column.sortable && sortTable(column.key)">
                  <div class="table-header-content">
                    <span>{{ column.label }}</span>
                  </div>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let bonus of sortedBonuses" (click)="openEmployeeModal(bonus)" class="employee-row">
                <td>{{ getEmployeeId(bonus) }}</td>
                <td>{{ getEmployeeName(bonus) }}</td>
                <td>{{ getBonus(bonus) | number }}</td>
                <td>{{ getStandardBonus(bonus) | number }}</td>
                <td>{{ getHealthInsurance(bonus, true) | number }}</td>
                <td>{{ getWelfarePension(bonus, true) | number }}</td>
                <td>{{ getNursingInsurance(bonus, true) | number }}</td>
                <td>{{ getPersonalBurden(bonus, true) | number }}</td>
                <td>{{ getCompanyBurden(bonus, true) | number }}</td>
              </tr>
            </tbody>
          </table>
          <!-- <div *ngIf="!employees || employees.length === 0" class="no-data-message">
            <p>データがありません</p>
          </div> -->
          </ng-container>
        </div>
      </div>
      <div *ngIf="selectedMenuId === 'company-settings'" class="settings-page-container">
        <div class="company-settings-form">
          <h2 class="form-title">企業情報設定</h2>
          <form (ngSubmit)="onCompanyInfoSubmit()" class="company-form">
            <div class="form-group">
              <label for="companyName" class="form-label">会社名（法人名）</label>
              <input 
                type="text" 
                id="companyName" 
                class="form-input"
                [(ngModel)]="companyInfo.companyName"
                name="companyName"
                [disabled]="!isCompanyInfoEditing"
                placeholder="会社名（法人名）を入力してください">
            </div>
            <div class="form-group">
              <label for="address" class="form-label">所在地（住所）</label>
              <input 
                type="text" 
                id="address" 
                class="form-input"
                [(ngModel)]="companyInfo.address"
                name="address"
                [disabled]="!isCompanyInfoEditing"
                placeholder="所在地（住所）を入力してください">
            </div>
            <div class="form-group">
              <label for="corporateNumber" class="form-label">法人番号</label>
              <input 
                type="text" 
                id="corporateNumber" 
                class="form-input"
                [(ngModel)]="companyInfo.corporateNumber"
                name="corporateNumber"
                [disabled]="!isCompanyInfoEditing"
                placeholder="法人番号を入力してください">
            </div>
            <div class="form-group">
              <label for="officeNumber" class="form-label">事業所番号（健康保険・厚生年金）</label>
              <input 
                type="text" 
                id="officeNumber" 
                class="form-input"
                [(ngModel)]="companyInfo.officeNumber"
                name="officeNumber"
                [disabled]="!isCompanyInfoEditing"
                placeholder="事業所番号を入力してください">
            </div>
            <div class="form-actions">
              <button 
                *ngIf="isCompanyInfoEditing" 
                type="submit" 
                class="submit-button">
                保存
              </button>
              <button 
                *ngIf="!isCompanyInfoEditing" 
                type="button" 
                class="edit-button"
                (click)="onEditCompanyInfo()">
                編集
              </button>
            </div>
          </form>
        </div>
      </div>
      <div *ngIf="selectedMenuId === 'health-insurance-settings'" class="settings-page-container">
        <div class="health-insurance-settings-form">
          <h2 class="form-title">健康保険設定</h2>
          <form (ngSubmit)="onHealthInsuranceSubmit()" class="health-insurance-form">
            <div class="form-group">
              <label class="form-label">健康保険種別</label>
              <div class="radio-group">
                <label class="radio-label">
                  <input 
                    type="radio" 
                    name="healthInsuranceType" 
                    value="kyokai"
                    [(ngModel)]="healthInsuranceType"
                    [disabled]="!isHealthInsuranceEditing"
                    (change)="onHealthInsuranceTypeChange('kyokai')">
                  <span>協会けんぽ</span>
                </label>
                <label class="radio-label">
                  <input 
                    type="radio" 
                    name="healthInsuranceType" 
                    value="kumiai"
                    [(ngModel)]="healthInsuranceType"
                    [disabled]="!isHealthInsuranceEditing"
                    (change)="onHealthInsuranceTypeChange('kumiai')">
                  <span>組合保険</span>
                </label>
              </div>
            </div>

            <!-- 協会けんぽの場合のフォーム -->
            <div *ngIf="healthInsuranceType === 'kyokai'" class="form-group">
              <label for="prefecture" class="form-label">都道府県</label>
              <select 
                id="prefecture" 
                class="form-select"
                [(ngModel)]="prefecture"
                name="prefecture"
                [disabled]="!isHealthInsuranceEditing">
                <option value="">都道府県を選択してください</option>
                <option *ngFor="let pref of prefectures" [value]="pref">
                  {{ pref }}
                </option>
              </select>
            </div>

            <!-- 組合保険の場合のフォーム -->
            <div *ngIf="healthInsuranceType === 'kumiai'" class="form-group">
              <label for="insuranceRate" class="form-label">保険料率</label>
              <div class="insurance-rate-input-wrapper">
                <input 
                  type="text" 
                  id="insuranceRate" 
                  class="form-input"
                  [class.error]="insuranceRateError"
                  [value]="insuranceRateDisplay"
                  name="insuranceRate"
                  [disabled]="!isHealthInsuranceEditing"
                  placeholder="保険料率を入力"
                  (input)="onInsuranceRateInput($event)"
                  (blur)="onInsuranceRateBlur()">
                <span class="percentage-symbol">%</span>
              </div>
              <div *ngIf="insuranceRateError" class="error-message">
                {{ insuranceRateError }}
              </div>
            </div>

            <!-- 組合保険の場合の保険料引き下げ額入力 -->
            <div *ngIf="healthInsuranceType === 'kumiai'" class="form-group">
              <label for="healthInsuranceReduction" class="form-label">従業員負担の保険料引き下げ額</label>
              <div class="insurance-rate-input-wrapper">
                <input 
                  type="text" 
                  id="healthInsuranceReduction" 
                  class="form-input"
                  [class.error]="healthInsuranceReductionError"
                  [value]="healthInsuranceReductionDisplay"
                  name="healthInsuranceReduction"
                  [disabled]="!isHealthInsuranceEditing"
                  placeholder="引き下げ額を入力"
                  (input)="onHealthInsuranceReductionInput($event)"
                  (blur)="onHealthInsuranceReductionBlur()">
                <span class="percentage-symbol">円</span>
              </div>
              <div *ngIf="healthInsuranceReductionError" class="error-message">
                {{ healthInsuranceReductionError }}
              </div>
            </div>

            <div class="form-actions">
              <button 
                *ngIf="isHealthInsuranceEditing" 
                type="submit" 
                class="submit-button">
                保存
              </button>
              <button 
                *ngIf="!isHealthInsuranceEditing" 
                type="button" 
                class="edit-button"
                (click)="onEditHealthInsurance()">
                編集
              </button>
            </div>
          </form>
        </div>
      </div>
      <div *ngIf="selectedMenuId === 'insurance-rate-inquiry'" class="settings-page-container">
        <div class="insurance-rate-inquiry-container">
          <h2 class="inquiry-title">保険料率照会</h2>
          <div class="rate-cards">
            <div class="rate-card">
              <div class="rate-card-header">
                <h3 class="rate-card-title">厚生年金保険料</h3>
              </div>
              <div class="rate-card-content">
                <p class="rate-value">18.3%</p>
              </div>
              <div class="rate-value-note">
                <p>※厚生年金保険料、介護保険料は令和7年度の料率です。</p>
              </div>
            </div>
            <div class="rate-card">
              <div class="rate-card-header">
                <h3 class="rate-card-title">介護保険料</h3>
              </div>
              <div class="rate-card-content">
                <p class="rate-value">1.59%</p>
              </div>
              <div class="rate-value-note">
                <p>※厚生年金保険料、介護保険料は令和7年度の料率です。</p>
                <p>※介護保険料は40歳以上の方が対象です。</p>
              </div>
            </div>
            <div class="rate-card">
              <div class="rate-card-header">
                <h3 class="rate-card-title">健康保険料</h3>
              </div>
              <div class="rate-card-content">
                <p *ngIf="healthInsuranceType === 'kumiai' && insuranceRate > 0" class="rate-value">{{ insuranceRate }}%</p>
                <p *ngIf="healthInsuranceType === 'kyokai' && prefecture && kenpoRates[prefecture]" class="rate-value">{{ kenpoRates[prefecture].healthRate }}%</p>
                <p *ngIf="healthInsuranceType === 'kyokai' && prefecture && !kenpoRates[prefecture]" class="rate-value-note">{{ prefecture }}</p>
                <p *ngIf="healthInsuranceType === 'kyokai' && !prefecture" class="rate-value-note">未設定</p>
                <p *ngIf="healthInsuranceType === 'kumiai' && insuranceRate === 0" class="rate-value-note">未設定</p>
              </div>
              <div class="rate-value-note">
                <p>※健康保険料は協会けんぽの場合、都道府県によって料率が異なります。</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div *ngIf="selectedMenuId === 'employee-settings'" class="settings-page-container">
        <app-import></app-import>
      </div>
      <div *ngIf="selectedMenuId === 'reports'" class="reports-container">
        <div class="report-filter-container">
          <div class="report-table-type-selector">
            <button 
              type="button"
              class="report-table-type-button"
              [class.active]="reportTableType === 'salary'"
              (click)="onReportTableTypeChange('salary')">
              給与
            </button>
            <button 
              type="button"
              class="report-table-type-button"
              [class.active]="reportTableType === 'bonus'"
              (click)="onReportTableTypeChange('bonus')">
              賞与
            </button>
          </div>
          <div class="filter-type-selector">
            <label class="filter-type-label">表示単位:</label>
            <div class="radio-group">
              <label class="radio-label">
                <input 
                  type="radio" 
                  name="reportFilterType" 
                  value="month"
                  [checked]="reportFilterType === 'month'"
                  (change)="onReportFilterTypeChange('month')">
                <span>月単位</span>
              </label>
              <label class="radio-label">
                <input 
                  type="radio" 
                  name="reportFilterType" 
                  value="year"
                  [checked]="reportFilterType === 'year'"
                  (change)="onReportFilterTypeChange('year')">
                <span>年単位</span>
              </label>
            </div>
          </div>
          <div class="filter-selector">
            <label *ngIf="reportFilterType === 'month'" for="report-month-select" class="filter-label">表示月:</label>
            <label *ngIf="reportFilterType === 'year'" for="report-year-select" class="filter-label">表示年:</label>
            <select 
              *ngIf="reportFilterType === 'month'"
              id="report-month-select" 
              class="filter-select"
              [value]="reportSelectedMonth"
              (change)="onReportMonthChange($any($event.target).value)">
              <option *ngFor="let month of (reportTableType === 'salary' ? availableMonths : availableBonusMonths)" [value]="month">
                {{ month }}
              </option>
            </select>
            <select 
              *ngIf="reportFilterType === 'year'"
              id="report-year-select" 
              class="filter-select"
              [value]="reportSelectedYear"
              (change)="onReportYearChange($any($event.target).value)">
              <option *ngFor="let year of (reportTableType === 'salary' ? availableYears : availableBonusYears)" [value]="year">
                {{ year }}年
              </option>
            </select>
          </div>
        </div>
        <div class="charts-container">
          <div class="chart-card">
            <h3 class="chart-title">社員負担額</h3>
            <div class="chart-wrapper">
              <canvas #personalBurdenChart></canvas>
            </div>
            <div class="chart-total">
              <p class="total-label">合計額</p>
              <p class="total-amount">{{ personalBurdenTotal.toLocaleString() }}円</p>
            </div>
          </div>
          <div class="chart-card">
            <h3 class="chart-title">会社負担額</h3>
            <div class="chart-wrapper">
              <canvas #companyBurdenChart></canvas>
            </div>
            <div class="chart-total">
              <p class="total-label">合計額</p>
              <p class="total-amount">{{ companyBurdenTotal.toLocaleString() }}円</p>
            </div>
          </div>
          <div class="chart-card">
            <h3 class="chart-title">合計保険料</h3>
            <div class="chart-wrapper">
              <canvas #totalBurdenChart></canvas>
            </div>
            <div class="chart-total">
              <p class="total-label">合計額</p>
              <p class="total-amount">{{ totalInsuranceTotal.toLocaleString() }}円</p>
            </div>
          </div>
        </div>
      </div>
      <!-- 書類作成ページ -->
      <div *ngIf="selectedMenuId === 'documents'" class="documents-container">
        <div class="documents-header">
          <h2 class="documents-title">書類作成</h2>
          <button 
            type="button"
            class="create-document-button"
            (click)="createDocument()">
            作成
          </button>
        </div>
        
        <div class="documents-controls">
          <!-- 書類選択 -->
          <div class="control-group">
            <label for="document-type-select" class="control-label">作成する書類:</label>
            <select 
              id="document-type-select" 
              class="control-select"
              [(ngModel)]="selectedDocumentType"
              (change)="onDocumentTypeChange()">
              <option value="">書類を選択</option>
              <option *ngFor="let docType of documentTypes" [value]="docType.id">
                {{ docType.label }}
              </option>
            </select>
          </div>
          
          <!-- 作成モード選択（給与/賞与明細書の場合のみ表示） -->
          <div *ngIf="selectedDocumentType === 'document6' || selectedDocumentType === 'document7'" class="control-group">
            <label class="control-label">作成モード:</label>
            <div class="mode-selector">
              <button 
                type="button"
                class="mode-button"
                [class.active]="documentCreationMode === 'bulk'"
                (click)="documentCreationMode = 'bulk'">
                一括作成
              </button>
              <button 
                type="button"
                class="mode-button"
                [class.active]="documentCreationMode === 'individual'"
                (click)="documentCreationMode = 'individual'">
                個人作成
              </button>
            </div>
          </div>
          
          <!-- 月選択（給与/賞与明細書の場合のみ表示） -->
          <div *ngIf="selectedDocumentType === 'document6' || selectedDocumentType === 'document7'" class="control-group">
            <label class="control-label">月:</label>
            <select 
              class="control-select"
              [(ngModel)]="payslipSelectedMonth"
              (change)="onPayslipMonthChange()">
              <option value="">月を選択</option>
              <option 
                *ngFor="let month of (selectedDocumentType === 'document7' ? payslipAvailableBonusMonths : payslipAvailableMonths)" 
                [value]="month">
                {{ month }}
              </option>
            </select>
          </div>
          
          <!-- 期間選択（社会保険料控除一覧表の場合のみ表示） -->
          <div *ngIf="selectedDocumentType === 'document1'" class="control-group">
            <label class="control-label">期間:</label>
            <div class="mode-selector">
              <button 
                type="button"
                class="mode-button"
                [class.active]="documentPeriodType === 'month'"
                (click)="documentPeriodType = 'month'">
                月単位
              </button>
              <button 
                type="button"
                class="mode-button"
                [class.active]="documentPeriodType === 'year'"
                (click)="documentPeriodType = 'year'">
                年単位
              </button>
              <button 
                type="button"
                class="mode-button"
                [class.active]="documentPeriodType === 'range'"
                (click)="documentPeriodType = 'range'">
                期間範囲
              </button>
            </div>
            <select 
              *ngIf="documentPeriodType === 'month'"
              class="control-select"
              [(ngModel)]="documentSelectedMonth">
              <option *ngFor="let month of documentAvailableMonths" [value]="month">
                {{ month }}
              </option>
            </select>
            <select 
              *ngIf="documentPeriodType === 'year'"
              class="control-select"
              [(ngModel)]="documentSelectedYear">
              <option *ngFor="let year of documentAvailableYears" [value]="year">
                {{ year }}年
              </option>
            </select>
            <div *ngIf="documentPeriodType === 'range'" class="range-selector">
              <select 
                class="control-select"
                [(ngModel)]="documentStartMonth">
                <option value="">開始月を選択</option>
                <option *ngFor="let month of documentAvailableMonths" [value]="month">
                  {{ month }}
                </option>
              </select>
              <span class="range-separator">～</span>
              <select 
                class="control-select"
                [(ngModel)]="documentEndMonth">
                <option value="">終了月を選択</option>
                <option *ngFor="let month of documentAvailableMonths" [value]="month">
                  {{ month }}
                </option>
              </select>
            </div>
          </div>
        </div>
        
        <!-- 一括作成フィルター（給与/賞与明細書の場合のみ表示） -->
        <div *ngIf="(selectedDocumentType === 'document6' || selectedDocumentType === 'document7') && documentCreationMode === 'bulk'" class="bulk-creation-container">
          <div class="filter-section">
            <h3 class="section-title">フィルター設定</h3>
            
            <div class="filter-options">
              <div class="filter-option">
                <label class="radio-label">
                  <input 
                    type="radio" 
                    name="bulkFilterType" 
                    value="all"
                    [(ngModel)]="bulkFilterType"
                    (change)="updatePayslipFilteredEmployees()">
                  <span>社員全員</span>
                </label>
              </div>
              <div class="filter-option">
                <label class="radio-label">
                  <input 
                    type="radio" 
                    name="bulkFilterType" 
                    value="department"
                    [(ngModel)]="bulkFilterType"
                    (change)="updatePayslipFilteredEmployees()">
                  <span>部署ごと</span>
                </label>
                <select 
                  *ngIf="bulkFilterType === 'department'"
                  class="filter-select"
                  [(ngModel)]="bulkFilterDepartment"
                  (change)="updatePayslipFilteredEmployees()">
                  <option value="">部署を選択</option>
                  <option *ngFor="let dept of availableDepartments" [value]="dept">
                    {{ dept }}
                  </option>
                </select>
              </div>
              <div class="filter-option">
                <label class="radio-label">
                  <input 
                    type="radio" 
                    name="bulkFilterType" 
                    value="nursing"
                    [(ngModel)]="bulkFilterType"
                    (change)="updatePayslipFilteredEmployees()">
                  <span>介護保険</span>
                </label>
                <select 
                  *ngIf="bulkFilterType === 'nursing'"
                  class="filter-select"
                  [(ngModel)]="bulkFilterNursingInsurance"
                  (change)="updatePayslipFilteredEmployees()">
                  <option value="all">すべて</option>
                  <option value="with">有</option>
                  <option value="without">無</option>
                </select>
              </div>
              <div class="filter-option">
                <label class="radio-label">
                  <input 
                    type="radio" 
                    name="bulkFilterType" 
                    value="custom"
                    [(ngModel)]="bulkFilterType"
                    (change)="onCustomFilterSelected()">
                  <span>社員を追加</span>
                </label>
              </div>
            </div>
            
            <!-- カスタム選択（自分で社員を追加） -->
            <div *ngIf="bulkFilterType === 'custom'" class="custom-selection-section">
              <div *ngIf="payslipSelectedMonth" class="all-employees-section">
                <h4 class="section-subtitle">全社員一覧から選択 ({{ payslipAllEmployees.length }}名)</h4>
                <div class="all-employees-list">
                  <div 
                    *ngFor="let emp of payslipAllEmployees" 
                    class="employee-select-item"
                    [class.selected]="isBulkEmployeeSelected(emp)"
                    (click)="toggleBulkEmployee(emp)">
                    <input 
                      type="checkbox"
                      [checked]="isBulkEmployeeSelected(emp)"
                      (click)="$event.stopPropagation()"
                      (change)="toggleBulkEmployee(emp)">
                    <span>{{ getEmployeeId(emp) }} - {{ getEmployeeName(emp) }}</span>
                  </div>
                </div>
                
                <div *ngIf="bulkSelectedEmployees.length > 0" class="selected-employees-summary">
                  <p class="selected-count">選択中: {{ bulkSelectedEmployees.length }}名</p>
                </div>
              </div>
              <div *ngIf="!payslipSelectedMonth" class="no-month-selected">
                <p>月を選択してください</p>
              </div>
            </div>
            
            <!-- フィルター結果表示 -->
            <div *ngIf="payslipSelectedMonth" class="filter-results-section">
              <h4 class="section-subtitle">フィルター結果 ({{ payslipFilteredEmployees.length }}名)</h4>
              <div *ngIf="payslipFilteredEmployees.length > 0" class="filtered-employees-list">
                <div 
                  *ngFor="let emp of payslipFilteredEmployees" 
                  class="filtered-employee-item">
                  <span>{{ getEmployeeId(emp) }} - {{ getEmployeeName(emp) }}</span>
                </div>
              </div>
              <div *ngIf="payslipFilteredEmployees.length === 0" class="no-results">
                <p>該当する社員がありません</p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- 個別作成（給与/賞与明細書の場合のみ表示） -->
        <div *ngIf="(selectedDocumentType === 'document6' || selectedDocumentType === 'document7') && documentCreationMode === 'individual'" class="individual-creation-container">
          <div class="search-section">
            <h3 class="section-title">社員検索</h3>
            <div class="search-box">
              <input 
                type="text" 
                class="search-input"
                placeholder="IDまたは名前で検索"
                [(ngModel)]="individualSearchTerm"
                (input)="onIndividualSearch()">
            </div>
            
            <div *ngIf="individualSearchTerm && individualSearchResults.length > 0" class="search-results">
              <div 
                *ngFor="let emp of individualSearchResults" 
                class="employee-item"
                [class.selected]="individualSelectedEmployee?.ID === emp.ID || individualSelectedEmployee?.id === emp.id"
                (click)="selectIndividualEmployee(emp)">
                <span>{{ getEmployeeId(emp) }} - {{ getEmployeeName(emp) }}</span>
              </div>
            </div>
            
            <div *ngIf="individualSearchTerm && individualSearchResults.length === 0" class="no-results">
              <p>該当する社員が見つかりませんでした</p>
            </div>
          </div>
        </div>
      </div>
      
      <div *ngIf="selectedMenuId !== 'insurance-list' && selectedMenuId !== 'company-settings' && selectedMenuId !== 'health-insurance-settings' && selectedMenuId !== 'employee-settings' && selectedMenuId !== 'insurance-rate-inquiry' && selectedMenuId !== 'reports' && selectedMenuId !== 'documents'" class="page-message">
        <p>{{ getSelectedMenuLabel() }}のページです。</p>
      </div>
    </main>
  </div>
</div>

<!-- チュートリアルオーバーレイ -->
<div *ngIf="isTutorialMode" class="tutorial-overlay">
  <div class="tutorial-modal" (click)="$event.stopPropagation()">
    <div class="tutorial-header">
      <h2 class="tutorial-title">{{ getCurrentTutorialStep()?.title }}</h2>
      <button class="tutorial-close" (click)="endTutorial()" type="button">×</button>
    </div>
    <div class="tutorial-content">
      <p class="tutorial-description">{{ getCurrentTutorialStep()?.description }}</p>
      <div class="tutorial-progress">
        <span class="tutorial-step-info">
          {{ currentTutorialStep + 1 }} / {{ tutorialSteps.length }}
        </span>
      </div>
    </div>
    <div class="tutorial-footer">
      <button 
        class="tutorial-button tutorial-button-secondary" 
        (click)="previousTutorialStep()" 
        [disabled]="currentTutorialStep === 0"
        type="button">
        前へ
      </button>
      <button 
        class="tutorial-button tutorial-button-primary" 
        (click)="nextTutorialStep()" 
        type="button">
        {{ currentTutorialStep === tutorialSteps.length - 1 ? '終了' : '次へ' }}
      </button>
    </div>
  </div>
</div>

<!-- 社員情報モーダル -->
<div *ngIf="isModalOpen" class="modal-overlay" (click)="closeEmployeeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">社員情報</h2>
      <div class="modal-header-actions">
        <button class="modal-create-button" (click)="createPayslipFromModal()" type="button">明細作成</button>
        <button class="modal-close-button" (click)="closeEmployeeModal()">×</button>
      </div>
    </div>
    <div class="modal-body" *ngIf="selectedEmployee">
      <div class="employee-info-container">
        <div class="info-row">
          <span class="info-label">ID</span>
          <span class="info-value">{{ getEmployeeField(selectedEmployee, 'ID') }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">氏名</span>
          <span class="info-value">{{ getEmployeeField(selectedEmployee, '氏名') }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">役職</span>
          <span class="info-value">{{ getEmployeeField(selectedEmployee, '役職') }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">部署</span>
          <span class="info-value">{{ getEmployeeField(selectedEmployee, '部署') }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">生年月日</span>
          <span class="info-value">{{ formatDate(getEmployeeField(selectedEmployee, '生年月日')) }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">雇用形態</span>
          <span class="info-value">{{ getEmployeeField(selectedEmployee, '雇用形態') }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">勤務地</span>
          <span class="info-value">{{ getEmployeeField(selectedEmployee, '勤務地') }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">年齢</span>
          <span class="info-value">{{ getEmployeeField(selectedEmployee, '年齢') }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">性別</span>
          <span class="info-value">{{ getEmployeeField(selectedEmployee, '性別') }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">入社日</span>
          <span class="info-value">{{ formatDate(getEmployeeField(selectedEmployee, '入社日')) }}</span>
        </div>
        <div class="info-row" *ngIf="!isBonusEmployee(selectedEmployee)">
          <span class="info-label">標準報酬月額</span>
          <span class="info-value">{{ getStandardSalary(selectedEmployee) | number }}円</span>
        </div>
        <div class="info-row" *ngIf="isBonusEmployee(selectedEmployee)">
          <span class="info-label">標準賞与額</span>
          <span class="info-value">{{ getStandardBonus(selectedEmployee) | number }}円</span>
        </div>
        <div class="info-row" *ngIf="!isBonusEmployee(selectedEmployee)">
          <span class="info-label">等級</span>
          <span class="info-value">{{ getGrade(selectedEmployee) }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">健康保険料</span>
          <span class="info-value">{{ getHealthInsurance(selectedEmployee, isBonusEmployee(selectedEmployee)) | number }}円</span>
        </div>
        <div class="info-row">
          <span class="info-label">厚生年金保険料</span>
          <span class="info-value">{{ getWelfarePension(selectedEmployee, isBonusEmployee(selectedEmployee)) | number }}円</span>
        </div>
        <div class="info-row">
          <span class="info-label">介護保険料</span>
          <span class="info-value">{{ getNursingInsurance(selectedEmployee, isBonusEmployee(selectedEmployee)) | number }}円</span>
        </div>
        <div class="info-row">
          <span class="info-label">本人負担額</span>
          <span class="info-value">{{ getPersonalBurden(selectedEmployee, isBonusEmployee(selectedEmployee)) | number }}円</span>
        </div>
        <div class="info-row">
          <span class="info-label">会社負担額</span>
          <span class="info-value">{{ getCompanyBurden(selectedEmployee, isBonusEmployee(selectedEmployee)) | number }}円</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- お知らせモーダル -->
<div *ngIf="isNotificationOpen" class="notification-overlay" (click)="closeNotification()">
  <div class="notification-modal" (click)="$event.stopPropagation()">
    <div class="notification-header">
      <h3 class="notification-title">お知らせ</h3>
      <button class="notification-close" (click)="closeNotification()">×</button>
    </div>
    <div class="notification-content">
      <div *ngIf="notifications.length === 0" class="notification-empty">
        <p>お知らせはありません</p>
      </div>
      <div 
        *ngFor="let notification of notifications; let i = index" 
        class="notification-item"
        [class.notification-read]="notification.read"
        (click)="markNotificationAsRead(i)">
        <div class="notification-icon">{{ getNotificationIcon(notification.type) }}</div>
        <div class="notification-text">
          <p class="notification-message">{{ notification.message }}</p>
          <p class="notification-date">{{ formatNotificationDate(notification.date) }}</p>
        </div>
      </div>
    </div>
  </div>
</div>
